<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Zenchain NFT Minter</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body{
      font-family:'Roboto',sans-serif;
      max-width:900px;
      margin:0 auto;
      padding:20px;
      background: linear-gradient(135deg,#f6d365,#fda085);
      color:#333;
    }
    h1{
      text-align:center;
      color:#fff;
      text-shadow: 1px 1px 4px rgba(0,0,0,0.4);
    }
    #acc{
      font-weight:600;
      margin-bottom:20px;
      color:#fff;
    }
    input,button{
      padding:10px 14px;
      margin:8px 0;
      border-radius:8px;
      border:none;
      font-size:16px;
    }
    input{
      width:100%;
      box-sizing:border-box;
    }
    button{
      cursor:pointer;
      background:#fff;
      color:#f76c6c;
      font-weight:700;
      transition: all 0.2s ease-in-out;
    }
    button:hover{
      background:#f76c6c;
      color:#fff;
    }
    #status{
      margin-top:12px;
      white-space:pre-wrap;
      background:rgba(255,255,255,0.9);
      padding:10px;
      border-radius:6px;
    }
    #nftPreview{
      margin-top:20px;
      text-align:center;
    }
    #nftPreview img{
      max-width:200px;
      border-radius:12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      margin-top:10px;
    }
    #totalMinted{
      margin-top:15px;
      font-weight:700;
      color:#fff;
    }
  </style>
</head>
<body>
  <h1>Zenchain NFT Minter ðŸŽ¨</h1>
  <p id="acc">Not connected</p>
  <button id="connect">Connect Wallet</button>

  <div style="margin-top:15px;">
    <label>Token metadata URL (JSON or image URL):</label><br/>
    <input id="tokenURI" placeholder="https://.../metadata.json"/>
  </div>
  <button id="mint">Mint NFT</button>

  <div id="status"></div>
  <div id="nftPreview"></div>
  <div id="totalMinted">Total Minted: 0</div>

  <!-- Ethers v5 CDN -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <script>
    const CONTRACT_ADDRESS = "0x107E2C6dd34C883161c2f1F619e651A5F1b4981F";
    const CONTRACT_ABI = [
      {"inputs":[{"internalType":"string","name":"uri","type":"string"}],"name":"mint","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"}
    ];

    let provider, signer, contract;
    let mintedCount = 0;

    async function connect() {
      const status = document.getElementById('status');
      try {
        if(!window.ethereum){ status.innerText='MetaMask not detected. Install MetaMask.'; return;}
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        const addr = await signer.getAddress();
        document.getElementById('acc').innerText = 'Connected: ' + addr;
        contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
        status.innerText = 'Connected. Make sure MetaMask is on Zenchain testnet.';
      } catch(err){
        status.innerText = 'Connection error: ' + (err?.message || err);
      }
    }

    async function mint() {
      const status = document.getElementById('status');
      const preview = document.getElementById('nftPreview');
      try{
        if(!contract){status.innerText='Connect wallet first.'; return;}
        const uri = document.getElementById('tokenURI').value.trim();
        if(!uri){status.innerText='Enter token metadata URL.'; return;}

        // Show preview
        preview.innerHTML = '<p>Preview:</p><img src="'+uri+'" alt="NFT Preview"/>';

        status.innerText = 'Sending transaction... confirm in MetaMask.';
        const tx = await contract.mint(uri);
        status.innerText = 'Transaction sent. Waiting confirmation...\nTx hash: ' + tx.hash;

        const receipt = await tx.wait();
        let tokenId = null;
        if(receipt && receipt.events){
          for(const e of receipt.events){
            if(e.event==='Transfer' && e.args && e.args.tokenId){
              tokenId = e.args.tokenId.toString();
              mintedCount++;
              break;
            }
          }
        }

        document.getElementById('totalMinted').innerText = 'Total Minted: ' + mintedCount;
        status.innerText = 'Mint confirmed!\nTx: ' + tx.hash + (tokenId?'\nToken ID: '+tokenId:'');
      } catch(err){
        console.error(err);
        status.innerText = 'Error: ' + (err?.message || err);
      }
    }

    document.getElementById('connect').addEventListener('click', connect);
    document.getElementById('mint').addEventListener('click', mint);
  </script>
</body>
</html>
